{% extends "base.html" %}

{% block title %}Invoice #{{ invoice.invoice_number }} - Institute Management System{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>Invoice #{{ invoice.invoice_number }}</h1>
    <p>View invoice details and payment history</p>
</div>

<div class="invoice-container">
    <div class="invoice-header">
        <div class="invoice-logo">
            <h2>IMS</h2>
            <p>Institute Management System</p>
        </div>
        <div class="invoice-info">
            <div class="info-item">
                <span class="label">Invoice Number:</span>
                <span class="value">{{ invoice.invoice_number }}</span>
            </div>
            <div class="info-item">
                <span class="label">Issue Date:</span>
                <span class="value">{{ invoice.issue_date }}</span>
            </div>
            <div class="info-item">
                <span class="label">Due Date:</span>
                <span class="value">{{ invoice.due_date }}</span>
            </div>
            <div class="info-item">
                <span class="label">Status:</span>
                <span class="value status-badge {% if invoice.status == 'paid' %}status-paid{% elif invoice.status == 'pending' %}status-pending{% elif invoice.status == 'overdue' %}status-overdue{% else %}status-cancelled{% endif %}">
                    {{ invoice.get_status_display }}
                </span>
            </div>
        </div>
    </div>
    
    <div class="invoice-parties">
        <div class="from-party">
            <h3>From</h3>
            <p class="party-name">Institute Management System</p>
            <p>123 Education Street</p>
            <p>Learning City, ED 12345</p>
            <p>Phone: (123) 456-7890</p>
            <p>Email: info@institute-ms.com</p>
        </div>
        <div class="to-party">
            <h3>To</h3>
            <p class="party-name">{{ invoice.student.user.get_full_name }}</p>
            <p>Student ID: {{ invoice.student.student_id }}</p>
            <p>{{ invoice.student.user.address|default:"No address provided" }}</p>
            <p>Phone: {{ invoice.student.user.mobile|default:"No phone provided" }}</p>
            <p>Email: {{ invoice.student.user.email|default:"No email provided" }}</p>
        </div>
    </div>
    
    <div class="invoice-items">
        <table class="invoice-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Description</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>
                        <div class="item-name">{{ item.category.name }}</div>
                        <div class="item-description">{{ item.description|default:item.category.description }}</div>
                    </td>
                    <td class="amount">${{ item.amount|floatformat:2 }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="text-center">No items found for this invoice.</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="2" class="text-right">Total</td>
                    <td class="amount">${{ invoice.total_amount|floatformat:2 }}</td>
                </tr>
                <tr>
                    <td colspan="2" class="text-right">Paid</td>
                    <td class="amount">${{ invoice.paid_amount|floatformat:2 }}</td>
                </tr>
                <tr class="balance-row">
                    <td colspan="2" class="text-right">Balance</td>
                    <td class="amount">${{ invoice.balance|floatformat:2 }}</td>
                </tr>
            </tfoot>
        </table>
    </div>
    
    <div class="invoice-payments">
        <h3>Payment History</h3>
        {% if payments %}
        <table class="payment-table">
            <thead>
                <tr>
                    <th>Receipt #</th>
                    <th>Date</th>
                    <th>Method</th>
                    <th>Transaction ID</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                {% for payment in payments %}
                <tr>
                    <td>{{ payment.receipt_number }}</td>
                    <td>{{ payment.payment_date }}</td>
                    <td>{{ payment.get_payment_method_display }}</td>
                    <td>{{ payment.transaction_id|default:"-" }}</td>
                    <td class="amount">${{ payment.amount|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="no-payments">No payments have been made for this invoice yet.</p>
        {% endif %}
    </div>
    
    <div class="invoice-notes">
        <h3>Notes</h3>
        <p>{{ invoice.notes|default:"No notes for this invoice." }}</p>
    </div>
    
    <div class="invoice-actions">
        {% if invoice.status != 'paid' and invoice.status != 'cancelled' %}
        <a href="{% url 'create_payment_for_invoice' invoice.id %}" class="btn btn-primary">
            <i class="fas fa-money-bill-wave"></i> Make Payment
        </a>
        {% endif %}
        
        <button onclick="window.print()" class="btn btn-outline">
            <i class="fas fa-print"></i> Print Invoice
        </button>
        
        {% if user.is_admin %}
        <a href="{% url 'fee_invoice_update' invoice.id %}" class="btn btn-warning">
            <i class="fas fa-edit"></i> Edit Invoice
        </a>
        {% endif %}
        
        <a href="{% if user.is_admin %}{% url 'fee_invoice_list' %}{% else %}{% url 'student_fee_list' %}{% endif %}" class="btn btn-outline">
            <i class="fas fa-arrow-left"></i> Back to List
        </a>
    </div>
</div>

<style>
    .invoice-container {
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        padding: var(--spacing-lg);
        margin-bottom: var(--spacing-lg);
    }
    
    .invoice-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--spacing-lg);
        padding-bottom: var(--spacing-lg);
        border-bottom: 1px solid var(--gray-300);
    }
    
    .invoice-logo h2 {
        margin-bottom: 0.25rem;
        color: var(--primary-color);
    }
    
    .invoice-logo p {
        color: var(--gray-600);
        font-size: 0.9rem;
    }
    
    .invoice-info {
        text-align: right;
    }
    
    .info-item {
        margin-bottom: 0.5rem;
    }
    
    .info-item .label {
        font-weight: 600;
        margin-right: 0.5rem;
        color: var(--gray-700);
    }
    
    .status-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.8rem;
        font-weight: 600;
    }
    
    .status-paid {
        background-color: rgba(46, 204, 113, 0.2);
        color: #2ecc71;
    }
    
    .status-pending {
        background-color: rgba(243, 156, 18, 0.2);
        color: #f39c12;
    }
    
    .status-overdue {
        background-color: rgba(231, 76, 60, 0.2);
        color: #e74c3c;
    }
    
    .status-cancelled {
        background-color: rgba(108, 117, 125, 0.2);
        color: #6c757d;
    }
    
    .invoice-parties {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--spacing-lg);
    }
    
    .from-party, .to-party {
        flex: 0 0 48%;
    }
    
    .from-party h3, .to-party h3 {
        margin-bottom: 0.75rem;
        font-size: 1.1rem;
        color: var(--gray-700);
        border-bottom: 1px solid var(--gray-300);
        padding-bottom: 0.5rem;
    }
    
    .party-name {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }
    
    .invoice-items {
        margin-bottom: var(--spacing-lg);
    }
    
    .invoice-table, .payment-table {
        width: 100%;
        border-collapse: collapse;
    }
    
    .invoice-table th, .invoice-table td,
    .payment-table th, .payment-table td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid var(--gray-300);
    }
    
    .invoice-table th, .payment-table th {
        background-color: var(--gray-100);
        font-weight: 600;
    }
    
    .item-name {
        font-weight: 600;
    }
    
    .item-description {
        font-size: 0.9rem;
        color: var(--gray-600);
        margin-top: 0.25rem;
    }
    
    .amount {
        text-align: right;
        font-weight: 600;
    }
    
    .text-right {
        text-align: right;
        font-weight: 600;
    }
    
    .text-center {
        text-align: center;
    }
    
    .balance-row {
        font-size: 1.1rem;
        background-color: var(--gray-100);
    }
    
    .invoice-payments {
        margin-bottom: var(--spacing-lg);
    }
    
    .invoice-payments h3, .invoice-notes h3 {
        margin-bottom: 1rem;
        font-size: 1.2rem;
        color: var(--gray-700);
    }
    
    .no-payments {
        color: var(--gray-600);
        font-style: italic;
    }
    
    .invoice-notes {
        margin-bottom: var(--spacing-lg);
        padding: var(--spacing-md);
        background-color: var(--gray-100);
        border-radius: var(--border-radius);
    }
    
    .invoice-actions {
        display: flex;
        gap: 1rem;
        margin-top: var(--spacing-lg);
    }
    
    @media print {
        .main-header, .sidebar, .main-footer, .invoice-actions {
            display: none !important;
        }
        
        .main-content {
            margin-left: 0 !important;
            padding: 0 !important;
        }
        
        .content-wrapper {
            padding: 0 !important;
        }
        
        .content {
            box-shadow: none !important;
            padding: 0 !important;
        }
        
        .invoice-container {
            box-shadow: none !important;
        }
    }
</style>
{% endblock %}
